import{a as e,b as t,k as s,l as r,F as o,a3 as a,i,j as n,c as p}from"./index-CZWEE5b-.js";import{_ as d,r as l}from"./_plugin-vue_export-helper.TrfrHBtf.js";const c={data:()=>({renderjsData:{posterType:"base64",posterQuality:.8,poster:""}}),methods:{setRenderjsPosterType(e,t){this.renderjsData.posterType=e},setRenderjsPosterQuality(e,t){this.renderjsData.posterQuality=e},setRenderjsPoster(e,t,s){this.renderjsData.poster=e},setPoster(e,t,s){const{posterQuality:r,poster:o,posterType:a}=this.renderjsData;if(o||!e)return;let i=document.createElement("video");i.setAttribute("crossOrigin","anonymous"),i.setAttribute("src",e),i.setAttribute("preload","auto"),i.muted=!0,i.style.display="none",i.addEventListener("loadeddata",(()=>{let e=document.createElement("canvas"),t=i.videoWidth,o=i.videoHeight;e.width=t,e.height=o,e.getContext("2d").drawImage(i,0,0,t,o);let n=e.toDataURL("image/jpeg",r);if("path"===a){const e=this.base64ToTempUrl(n,s);e&&s.callMethod("getPoster",e),this.disposeVideo(i)}else s.callMethod("getPoster",n),this.disposeVideo(i)})),i.addEventListener("error",(()=>{this.disposeVideo(i)})),i.play().catch((()=>{}))},disposeVideo(e){e&&(e.pause(),e.src="",e.load(),e.remove())},base64ToTempUrl(e,t){try{if(!e||!e.startsWith("data:image/"))throw new Error("无效的base64图片格式");const[t,s]=e.split(","),r=t.match(/:(.*?);/)[1],o=atob(s),a=new Array(o.length);for(let e=0;e<o.length;e++)a[e]=o.charCodeAt(e);const i=new Uint8Array(a),n=new Blob([i],{type:r});return URL.createObjectURL(n)}catch(s){return t.callMethod("setPosterError",s),""}}}},h=e=>{e.$renderjs||(e.$renderjs=[]),e.$renderjs.push("video"),e.mixins||(e.mixins=[]),e.mixins.push({beforeCreate(){this.video=this},mounted(){this.$ownerInstance=this.$gcd(this,!0)}}),e.mixins.push(c)},u={props:{src:{type:String,default:""},poster:{type:String,default:""},posterType:{type:String,default:"base64"},posterQuality:{type:Number,default:.8}},data:()=>({aotoPoster:""}),methods:{getPoster(e){this.$emit("getPoster",e),this.aotoPoster=e},setPosterError(e){this.$emit("setPosterError",e)}}};h(u);const y=d(u,[["render",function(n,p,d,l,c,h){const u=a,y=i;return e(),t(o,null,[s(u,r({src:d.src,poster:c.aotoPoster},n.$attrs),null,16,["src","poster"]),s(y,{poster:d.poster,"change:poster":n.video.setRenderjsPoster,posterType:d.posterType,"change:posterType":n.video.setRenderjsPosterType,posterQuality:d.posterQuality,"change:posterQuality":n.video.setRenderjsPosterQuality,src:d.src,"change:src":n.video.setPoster,style:{display:"none"}},null,8,["poster","change:poster","posterType","change:posterType","posterQuality","change:posterQuality","src","change:src"])],64)}]]),g={__name:"index",setup(t){const s=e=>{console.log(e,"poster")},r=()=>{console.log("play")};return(t,o)=>{const a=l(n("cl-video"),y);return e(),p(a,{src:"https://code-life-1302946402.cos.ap-chongqing.myqcloud.com/other/video/strawberry.mp4",posterType:"path","object-fit":"contain",style:{width:"400px",height:"300px"},onGetPoster:s,onPlay:r})}}};export{g as default};
